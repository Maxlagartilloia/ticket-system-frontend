<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>CopierMaster | Sistema de Tickets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Estilos -->
    <link rel="stylesheet" href="css/styles.css" />

    <!-- Fuente elegante -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="login-container">
        <div class="login-card">

            <!-- LOGO -->
            <div class="logo-container">
                <img src="assets/logo.png" alt="CopierMaster" />
            </div>

            <!-- TÍTULO -->
            <h1>Sistema de Tickets</h1>
            <p class="subtitle">
                Acceso exclusivo para clientes y personal autorizado
            </p>

            <!-- FORMULARIO -->
            <form id="loginForm">
                <div class="input-group">
                    <label for="email">Correo electrónico</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        placeholder="usuario@institucion.gob.ec"
                        required
                    />
                </div>

                <div class="input-group">
                    <label for="password">Contraseña</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        placeholder="••••••••"
                        required
                    />
                </div>

                <button type="submit" class="btn-login">
                    Ingresar
                </button>
            </form>

            <!-- MENSAJE DE ERROR -->
            <div id="errorMessage" class="error-message"></div>

            <!-- FOOTER -->
            <div class="login-footer">
                <span>© 2026 CopierMaster C&amp;G</span>
            </div>

        </div>
    </div>

    <!-- JS -->
    <script>
        const API_BASE_URL = "https://ticket-system-backend-4h25.onrender.com";

        const loginForm = document.getElementById("loginForm");
        const errorMessage = document.getElementById("errorMessage");

        loginForm.addEventListener("submit", async function (e) {
            e.preventDefault();
            errorMessage.textContent = "";

            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value.trim();

            try {
                const response = await fetch(API_BASE_URL + "/auth/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        email: email,
                        password: password
                    })
                });

                if (!response.ok) {
                    throw new Error("Credenciales incorrectas");
                }

                const data = await response.json();

                // Guardar token y datos del usuario
                localStorage.setItem("access_token", data.access_token);
                localStorage.setItem("user_role", data.role);
                localStorage.setItem("user_name", data.nombre);

                // Redirección según rol
                if (data.role === "admin" || data.role === "supervisor") {
                    window.location.href = "dashboard.html";
                } else {
                    window.location.href = "tickets.html";
                }

            } catch (error) {
                errorMessage.textContent = "Correo o contraseña incorrectos.";
            }
        });
    </script>

</body>
</html>
